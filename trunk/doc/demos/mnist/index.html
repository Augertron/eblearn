<html>
  <head>
    <link rel="stylesheet" href="../../web/main.css" type="text/css" 
	  media="screen">
    <link rel="stylesheet" href="../../web/index_004.css" type="text/css" 
	  media="screen">
    <link rel="stylesheet" href="../../web/styles.css" type="text/css" 
	  media="all">

  </head>
  <body>
    <div id="globalWrapper">
      <h1 id="firstHeading" class="firstHeading"><b>MNIST demo:</b> handwritten digits recognition using the eblearn C++ library</h1>
      <h3 id="siteSub">By <a href="http://sermanet.free.fr">Pierre Sermanet</a> and <a href="http://yann.lecun.com/">Yann LeCun</a> (New York University)</h3><br><br>
      
      <p>The eblearn (energy-based learning) C++ library <b>libeblearn</b> contains machine learning algorithms which can be used for computer vision.
      The library has a generic and modular architecture, allowing easy prototyping and building of different algorithms 
      (supervised or unsupervised learning) and configurations
      from basic modules. Those algorithms were used for a variety for applications, including robotics with the 
      <a href="http://www.cs.nyu.edu/~yann/research/lagr/">Learning Applied to Ground Robots</a> DARPA project (LAGR).</p>

      <p>In this demo, we show how to train a convolutional neural network to identify the digit value in images of handwritten digits.
      For that purpose, we use the <a href="http://yann.lecun.com/exdb/mnist/">MNIST dataset</a> which contains 60,000 images of handwritten digits for training and 
      10,000 for testing.</p>

      <h2>Dataset and classification</h2>
      <br>
      <img src="img/mnist_datasets.png">
      
      <h2>Internal Neural Network states</h2>
      <br>
      <img src="img/mnist_fprop.png">
      
      <table class="toccolours" style="margin: 0pt 0pt 1em 1em; padding: 0px; width: 170px;" align="left">
	<tr>
	    <h2><span class="mw-headline">Quick training and testing demo</span></h2>
	    <p>Here we quickly go through the main components of the demo so that you can experiment yourself with the library as fast as possible.</p>

<div id="vc_markup"><pre><a id="l_1"></a><span class="hl line">    1 </span><span class="hl dir">#include</span> <span class="hl dstr">&quot;libeblearn.h&quot;</span><span class="hl dir"></span>
<a id="l_2"></a><span class="hl line">    2 </span>
<a id="l_3"></a><span class="hl line">    3 </span><span class="hl kwa">using namespace</span> std<span class="hl sym">;</span>
<a id="l_4"></a><span class="hl line">    4 </span><span class="hl kwa">using namespace</span> ebl<span class="hl sym">;</span> <span class="hl slc">// all eblearn objects are under the ebl namespace</span>
<a id="l_5"></a><span class="hl line">    5 </span>
<a id="l_6"></a><span class="hl line">    6 </span><span class="hl slc">// argv[1] is expected to contain the directory of the mnist dataset</span>
<a id="l_7"></a><span class="hl line">    7 </span><span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl sym">(</span><span class="hl kwb">int</span> argc<span class="hl sym">,</span> <span class="hl kwb">char</span> <span class="hl sym">**</span>argv<span class="hl sym">) {</span>
<a id="l_8"></a><span class="hl line">    8 </span>  cout <span class="hl sym">&lt;&lt;</span> endl <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;* MNIST demo: learning handwritten digits using the eblearn&quot;</span><span class="hl sym">;</span>
<a id="l_9"></a><span class="hl line">    9 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot; C++ library *&quot;</span> <span class="hl sym">&lt;&lt;</span> endl<span class="hl sym">;</span>
<a id="l_10"></a><span class="hl line">   10 </span>  <span class="hl kwd">init_drand</span><span class="hl sym">(</span><span class="hl kwd">time</span><span class="hl sym">(</span>NULL<span class="hl sym">));</span> <span class="hl slc">// initialize random seed</span>
<a id="l_11"></a><span class="hl line">   11 </span>
<a id="l_12"></a><span class="hl line">   12 </span>  intg trsize <span class="hl sym">=</span> <span class="hl num">2000</span><span class="hl sym">;</span> <span class="hl slc">// maximum training set size: 60000</span>
<a id="l_13"></a><span class="hl line">   13 </span>  intg tesize <span class="hl sym">=</span> <span class="hl num">1000</span><span class="hl sym">;</span> <span class="hl slc">// maximum testing set size:  10000</span>
<a id="l_14"></a><span class="hl line">   14 </span>
<a id="l_15"></a><span class="hl line">   15 </span>  <span class="hl slc">// load MNIST datasets: trize for training set and tesize for testing set</span>
<a id="l_16"></a><span class="hl line">   16 </span>  MnistDataSource<span class="hl sym">&lt;</span>ubyte<span class="hl sym">,</span>ubyte<span class="hl sym">&gt;</span> train_ds<span class="hl sym">,</span> test_ds<span class="hl sym">;</span>
<a id="l_17"></a><span class="hl line">   17 </span>  <span class="hl kwd">load_mnist_dataset</span><span class="hl sym">(</span>argv<span class="hl sym">[</span><span class="hl num">1</span><span class="hl sym">],</span> train_ds<span class="hl sym">,</span> test_ds<span class="hl sym">,</span> trsize<span class="hl sym">,</span> tesize<span class="hl sym">);</span>
<a id="l_18"></a><span class="hl line">   18 </span>
<a id="l_19"></a><span class="hl line">   19 </span>  <span class="hl slc">// create 1-of-n targets with target 1.0 for shown class, -1.0 for the rest</span>
<a id="l_20"></a><span class="hl line">   20 </span>  Idx<span class="hl sym">&lt;</span><span class="hl kwb">double</span><span class="hl sym">&gt;</span> targets <span class="hl sym">=</span> <span class="hl kwd">create_target_matrix</span><span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">+</span><span class="hl kwd">idx_max</span><span class="hl sym">(</span>train_ds<span class="hl sym">.</span>labels<span class="hl sym">),</span> <span class="hl num">1.0</span><span class="hl sym">);</span>
<a id="l_21"></a><span class="hl line">   21 </span>
<a id="l_22"></a><span class="hl line">   22 </span>  <span class="hl slc">// create the network weights, network and trainer</span>
<a id="l_23"></a><span class="hl line">   23 </span>  IdxDim <span class="hl kwd">dims</span><span class="hl sym">(</span>train_ds<span class="hl sym">.</span>data<span class="hl sym">.</span>spec<span class="hl sym">);</span> <span class="hl slc">// get order and dimenions from data</span>
<a id="l_24"></a><span class="hl line">   24 </span>  parameter <span class="hl kwd">theparam</span><span class="hl sym">(</span><span class="hl num">60000</span><span class="hl sym">);</span> <span class="hl slc">// create trainable parameter</span>
<a id="l_25"></a><span class="hl line">   25 </span>  lenet5 <span class="hl kwd">l5</span><span class="hl sym">(</span>theparam<span class="hl sym">,</span> <span class="hl num">32</span><span class="hl sym">,</span> <span class="hl num">32</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">120</span><span class="hl sym">,</span> targets<span class="hl sym">.</span><span class="hl kwd">dim</span><span class="hl sym">(</span><span class="hl num">0</span><span class="hl sym">));</span>
<a id="l_26"></a><span class="hl line">   26 </span>  supervised_euclidean_machine <span class="hl kwd">thenet</span><span class="hl sym">(</span>l5<span class="hl sym">,</span> targets<span class="hl sym">,</span> dims<span class="hl sym">);</span>
<a id="l_27"></a><span class="hl line">   27 </span>  supervised_trainer<span class="hl sym">&lt;</span>ubyte<span class="hl sym">,</span>ubyte<span class="hl sym">&gt;</span> <span class="hl kwd">thetrainer</span><span class="hl sym">(</span>thenet<span class="hl sym">,</span> theparam<span class="hl sym">);</span>
<a id="l_28"></a><span class="hl line">   28 </span>
<a id="l_29"></a><span class="hl line">   29 </span>  <span class="hl slc">// a classifier-meter measures classification errors</span>
<a id="l_30"></a><span class="hl line">   30 </span>  classifier_meter trainmeter<span class="hl sym">,</span> testmeter<span class="hl sym">;</span>
<a id="l_31"></a><span class="hl line">   31 </span>
<a id="l_32"></a><span class="hl line">   32 </span>  <span class="hl slc">// initialize the network weights</span>
<a id="l_33"></a><span class="hl line">   33 </span>  forget_param_linear <span class="hl kwd">fgp</span><span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">,</span> <span class="hl num">0.5</span><span class="hl sym">);</span>
<a id="l_34"></a><span class="hl line">   34 </span>  thenet<span class="hl sym">.</span><span class="hl kwd">forget</span><span class="hl sym">(</span>fgp<span class="hl sym">);</span>
<a id="l_35"></a><span class="hl line">   35 </span>
<a id="l_36"></a><span class="hl line">   36 </span>  <span class="hl slc">// learning parameters</span>
<a id="l_37"></a><span class="hl line">   37 </span>  gd_param <span class="hl kwd">gdp</span><span class="hl sym">(</span><span class="hl com">/* double leta*/</span> <span class="hl num">0.0001</span><span class="hl sym">,</span>
<a id="l_38"></a><span class="hl line">   38 </span>	       <span class="hl com">/* double ln */</span> 	<span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_39"></a><span class="hl line">   39 </span>	       <span class="hl com">/* double l1 */</span> 	<span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_40"></a><span class="hl line">   40 </span>	       <span class="hl com">/* double l2 */</span> 	<span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_41"></a><span class="hl line">   41 </span>	       <span class="hl com">/* int dtime */</span> 	<span class="hl num">0</span><span class="hl sym">,</span>
<a id="l_42"></a><span class="hl line">   42 </span>	       <span class="hl com">/* double iner */</span><span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_43"></a><span class="hl line">   43 </span>	       <span class="hl com">/* double a_v */</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_44"></a><span class="hl line">   44 </span>	       <span class="hl com">/* double a_t */</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_45"></a><span class="hl line">   45 </span>	       <span class="hl com">/* double g_t*/</span> 	<span class="hl num">0.0</span><span class="hl sym">);</span>
<a id="l_46"></a><span class="hl line">   46 </span>
<a id="l_47"></a><span class="hl line">   47 </span>  <span class="hl slc">// estimate second derivative on 100 iterations, using mu=0.02</span>
<a id="l_48"></a><span class="hl line">   48 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;Computing second derivatives on MNIST dataset: &quot;</span><span class="hl sym">;</span>
<a id="l_49"></a><span class="hl line">   49 </span>  thetrainer<span class="hl sym">.</span><span class="hl kwd">compute_diaghessian</span><span class="hl sym">(</span>train_ds<span class="hl sym">,</span> <span class="hl num">100</span><span class="hl sym">,</span> <span class="hl num">0.02</span><span class="hl sym">);</span>
<a id="l_50"></a><span class="hl line">   50 </span>
<a id="l_51"></a><span class="hl line">   51 </span>  <span class="hl slc">// do training iterations</span>
<a id="l_52"></a><span class="hl line">   52 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;Training network on MNIST with &quot;</span> <span class="hl sym">&lt;&lt;</span> train_ds<span class="hl sym">.</span><span class="hl kwd">size</span><span class="hl sym">();</span>
<a id="l_53"></a><span class="hl line">   53 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot; training samples and &quot;</span> <span class="hl sym">&lt;&lt;</span> test_ds<span class="hl sym">.</span><span class="hl kwd">size</span><span class="hl sym">() &lt;&lt;</span> <span class="hl str">&quot; test samples&quot;</span> <span class="hl sym">&lt;&lt;</span> endl<span class="hl sym">;</span>
<a id="l_54"></a><span class="hl line">   54 </span>  <span class="hl kwa">for</span> <span class="hl sym">(</span><span class="hl kwb">int</span> i <span class="hl sym">=</span> <span class="hl num">0</span><span class="hl sym">;</span> i <span class="hl sym">&lt;</span> <span class="hl num">5</span><span class="hl sym">; ++</span>i<span class="hl sym">) {</span>
<a id="l_55"></a><span class="hl line">   55 </span>    thetrainer<span class="hl sym">.</span><span class="hl kwd">train</span><span class="hl sym">(</span>train_ds<span class="hl sym">,</span> trainmeter<span class="hl sym">,</span> gdp<span class="hl sym">,</span> <span class="hl num">1</span><span class="hl sym">);</span>
<a id="l_56"></a><span class="hl line">   56 </span>    cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;training: &quot;</span> <span class="hl sym">&lt;&lt;</span> flush<span class="hl sym">;</span>
<a id="l_57"></a><span class="hl line">   57 </span>    thetrainer<span class="hl sym">.</span><span class="hl kwd">test</span><span class="hl sym">(</span>train_ds<span class="hl sym">,</span> trainmeter<span class="hl sym">);</span>
<a id="l_58"></a><span class="hl line">   58 </span>    trainmeter<span class="hl sym">.</span><span class="hl kwd">display</span><span class="hl sym">();</span>
<a id="l_59"></a><span class="hl line">   59 </span>    cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot; testing: &quot;</span> <span class="hl sym">&lt;&lt;</span> flush<span class="hl sym">;</span>
<a id="l_60"></a><span class="hl line">   60 </span>    thetrainer<span class="hl sym">.</span><span class="hl kwd">test</span><span class="hl sym">(</span>test_ds<span class="hl sym">,</span> testmeter<span class="hl sym">);</span>
<a id="l_61"></a><span class="hl line">   61 </span>    testmeter<span class="hl sym">.</span><span class="hl kwd">display</span><span class="hl sym">();</span>
<a id="l_62"></a><span class="hl line">   62 </span>  <span class="hl sym">}</span>
<a id="l_63"></a><span class="hl line">   63 </span>  <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl sym">;</span>
<a id="l_64"></a><span class="hl line">   64 </span><span class="hl sym">}</span>
</pre></div>

	    <h2><span class="mw-headline">Output</span></h2>
	    <p>The output after running the demo.</p>
	    <pre>
$ ./mnist /d/taf/data/mnist
* MNIST demo: learning handwritten digits using the eblearn C++ library *
Computing second derivatives on MNIST dataset: diaghessian inf: 0.985298 sup: 49.7398
Training network on MNIST with 2000 training samples and 1000 test samples
training: [ 2000]  size=2000  energy=0.19  correct=88.80%  errors=11.20%  rejects=0.00%
 testing: [ 2000]  size=1000  energy=0.163  correct=90.50%  errors=9.50%  rejects=0.00%
training: [ 4000]  size=2000  energy=0.1225  correct=93.25%  errors=6.75%  rejects=0.00%
 testing: [ 4000]  size=1000  energy=0.121  correct=92.80%  errors=7.20%  rejects=0.00%
training: [ 6000]  size=2000  energy=0.084  correct=95.45%  errors=4.55%  rejects=0.00%
 testing: [ 6000]  size=1000  energy=0.098  correct=94.70%  errors=5.30%  rejects=0.00%
training: [ 8000]  size=2000  energy=0.065  correct=96.45%  errors=3.55%  rejects=0.00%
 testing: [ 8000]  size=1000  energy=0.095  correct=95.20%  errors=4.80%  rejects=0.00%
training: [10000]  size=2000  energy=0.0545  correct=97.15%  errors=2.85%  rejects=0.00%
 testing: [10000]  size=1000  energy=0.094  correct=95.80%  errors=4.20%  rejects=0.00%
	    </pre>
	    

	    <h2><span class="mw-headline">Detailed explanation</span></h2>
	    <p>Here we quickly go through the main components of the demo so that you can experiment yourself with the library as fast as possible.</p>

<div id="vc_markup"><pre><a id="l_1"></a><span class="hl line">    1 </span><span class="hl dir">#include</span> <span class="hl dstr">&quot;libeblearn.h&quot;</span><span class="hl dir"></span>
<a id="l_2"></a><span class="hl line">    2 </span>
<a id="l_3"></a><span class="hl line">    3 </span><span class="hl kwa">using namespace</span> std<span class="hl sym">;</span>
<a id="l_4"></a><span class="hl line">    4 </span><span class="hl kwa">using namespace</span> ebl<span class="hl sym">;</span> <span class="hl slc">// all eblearn objects are under the ebl namespace</span>
<a id="l_5"></a><span class="hl line">    5 </span>
<a id="l_6"></a><span class="hl line">    6 </span><span class="hl slc">// argv[1] is expected to contain the directory of the mnist dataset</span>
<a id="l_7"></a><span class="hl line">    7 </span><span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl sym">(</span><span class="hl kwb">int</span> argc<span class="hl sym">,</span> <span class="hl kwb">char</span> <span class="hl sym">**</span>argv<span class="hl sym">) {</span>
<a id="l_8"></a><span class="hl line">    8 </span>  cout <span class="hl sym">&lt;&lt;</span> endl <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;* MNIST demo: learning handwritten digits using the eblearn&quot;</span><span class="hl sym">;</span>
<a id="l_9"></a><span class="hl line">    9 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot; C++ library *&quot;</span> <span class="hl sym">&lt;&lt;</span> endl<span class="hl sym">;</span>
<a id="l_10"></a><span class="hl line">   10 </span>  <span class="hl kwd">init_drand</span><span class="hl sym">(</span><span class="hl kwd">time</span><span class="hl sym">(</span>NULL<span class="hl sym">));</span> <span class="hl slc">// initialize random seed</span>
<a id="l_11"></a><span class="hl line">   11 </span>
<a id="l_12"></a><span class="hl line">   12 </span>  intg trsize <span class="hl sym">=</span> <span class="hl num">2000</span><span class="hl sym">;</span> <span class="hl slc">// maximum training set size: 60000</span>
<a id="l_13"></a><span class="hl line">   13 </span>  intg tesize <span class="hl sym">=</span> <span class="hl num">1000</span><span class="hl sym">;</span> <span class="hl slc">// maximum testing set size:  10000</span>
<a id="l_14"></a><span class="hl line">   14 </span>

</pre> Details. <pre>

<a id="l_15"></a><span class="hl line">   15 </span>  <span class="hl slc">// load MNIST datasets: trize for training set and tesize for testing set</span>
<a id="l_16"></a><span class="hl line">   16 </span>  MnistDataSource<span class="hl sym">&lt;</span>ubyte<span class="hl sym">,</span>ubyte<span class="hl sym">&gt;</span> train_ds<span class="hl sym">,</span> test_ds<span class="hl sym">;</span>
<a id="l_17"></a><span class="hl line">   17 </span>  <span class="hl kwd">load_mnist_dataset</span><span class="hl sym">(</span>argv<span class="hl sym">[</span><span class="hl num">1</span><span class="hl sym">],</span> train_ds<span class="hl sym">,</span> test_ds<span class="hl sym">,</span> trsize<span class="hl sym">,</span> tesize<span class="hl sym">);</span>

</pre> Details. <pre>

<a id="l_18"></a><span class="hl line">   18 </span>
<a id="l_19"></a><span class="hl line">   19 </span>  <span class="hl slc">// create 1-of-n targets with target 1.0 for shown class, -1.0 for the rest</span>
<a id="l_20"></a><span class="hl line">   20 </span>  Idx<span class="hl sym">&lt;</span><span class="hl kwb">double</span><span class="hl sym">&gt;</span> targets <span class="hl sym">=</span> <span class="hl kwd">create_target_matrix</span><span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">+</span><span class="hl kwd">idx_max</span><span class="hl sym">(</span>train_ds<span class="hl sym">.</span>labels<span class="hl sym">),</span> <span class="hl num">1.0</span><span class="hl sym">);</span>
<a id="l_21"></a><span class="hl line">   21 </span>

</pre> Details. <pre>

<a id="l_22"></a><span class="hl line">   22 </span>  <span class="hl slc">// create the network weights, network and trainer</span>
<a id="l_23"></a><span class="hl line">   23 </span>  IdxDim <span class="hl kwd">dims</span><span class="hl sym">(</span>train_ds<span class="hl sym">.</span>data<span class="hl sym">.</span>spec<span class="hl sym">);</span> <span class="hl slc">// get order and dimenions from data</span>
<a id="l_24"></a><span class="hl line">   24 </span>  parameter <span class="hl kwd">theparam</span><span class="hl sym">(</span><span class="hl num">60000</span><span class="hl sym">);</span> <span class="hl slc">// create trainable parameter</span>
<a id="l_25"></a><span class="hl line">   25 </span>  lenet5 <span class="hl kwd">l5</span><span class="hl sym">(</span>theparam<span class="hl sym">,</span> <span class="hl num">32</span><span class="hl sym">,</span> <span class="hl num">32</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">5</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">2</span><span class="hl sym">,</span> <span class="hl num">120</span><span class="hl sym">,</span> targets<span class="hl sym">.</span><span class="hl kwd">dim</span><span class="hl sym">(</span><span class="hl num">0</span><span class="hl sym">));</span>
<a id="l_26"></a><span class="hl line">   26 </span>  supervised_euclidean_machine <span class="hl kwd">thenet</span><span class="hl sym">(</span>l5<span class="hl sym">,</span> targets<span class="hl sym">,</span> dims<span class="hl sym">);</span>
<a id="l_27"></a><span class="hl line">   27 </span>  supervised_trainer<span class="hl sym">&lt;</span>ubyte<span class="hl sym">,</span>ubyte<span class="hl sym">&gt;</span> <span class="hl kwd">thetrainer</span><span class="hl sym">(</span>thenet<span class="hl sym">,</span> theparam<span class="hl sym">);</span>
<a id="l_28"></a><span class="hl line">   28 </span>
<a id="l_29"></a><span class="hl line">   29 </span>  <span class="hl slc">// a classifier-meter measures classification errors</span>
<a id="l_30"></a><span class="hl line">   30 </span>  classifier_meter trainmeter<span class="hl sym">,</span> testmeter<span class="hl sym">;</span>
<a id="l_31"></a><span class="hl line">   31 </span>

</pre> Details. <pre>

<a id="l_32"></a><span class="hl line">   32 </span>  <span class="hl slc">// initialize the network weights</span>
<a id="l_33"></a><span class="hl line">   33 </span>  forget_param_linear <span class="hl kwd">fgp</span><span class="hl sym">(</span><span class="hl num">1</span><span class="hl sym">,</span> <span class="hl num">0.5</span><span class="hl sym">);</span>
<a id="l_34"></a><span class="hl line">   34 </span>  thenet<span class="hl sym">.</span><span class="hl kwd">forget</span><span class="hl sym">(</span>fgp<span class="hl sym">);</span>
<a id="l_35"></a><span class="hl line">   35 </span>
<a id="l_36"></a><span class="hl line">   36 </span>  <span class="hl slc">// learning parameters</span>
<a id="l_37"></a><span class="hl line">   37 </span>  gd_param <span class="hl kwd">gdp</span><span class="hl sym">(</span><span class="hl com">/* double leta*/</span> <span class="hl num">0.0001</span><span class="hl sym">,</span>
<a id="l_38"></a><span class="hl line">   38 </span>	       <span class="hl com">/* double ln */</span> 	<span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_39"></a><span class="hl line">   39 </span>	       <span class="hl com">/* double l1 */</span> 	<span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_40"></a><span class="hl line">   40 </span>	       <span class="hl com">/* double l2 */</span> 	<span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_41"></a><span class="hl line">   41 </span>	       <span class="hl com">/* int dtime */</span> 	<span class="hl num">0</span><span class="hl sym">,</span>
<a id="l_42"></a><span class="hl line">   42 </span>	       <span class="hl com">/* double iner */</span><span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_43"></a><span class="hl line">   43 </span>	       <span class="hl com">/* double a_v */</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_44"></a><span class="hl line">   44 </span>	       <span class="hl com">/* double a_t */</span> <span class="hl num">0.0</span><span class="hl sym">,</span>
<a id="l_45"></a><span class="hl line">   45 </span>	       <span class="hl com">/* double g_t*/</span> 	<span class="hl num">0.0</span><span class="hl sym">);</span>
<a id="l_46"></a><span class="hl line">   46 </span>

</pre> Details. <pre>

<a id="l_47"></a><span class="hl line">   47 </span>  <span class="hl slc">// estimate second derivative on 100 iterations, using mu=0.02</span>
<a id="l_48"></a><span class="hl line">   48 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;Computing second derivatives on MNIST dataset: &quot;</span><span class="hl sym">;</span>
<a id="l_49"></a><span class="hl line">   49 </span>  thetrainer<span class="hl sym">.</span><span class="hl kwd">compute_diaghessian</span><span class="hl sym">(</span>train_ds<span class="hl sym">,</span> <span class="hl num">100</span><span class="hl sym">,</span> <span class="hl num">0.02</span><span class="hl sym">);</span>
<a id="l_50"></a><span class="hl line">   50 </span>

</pre> Details. <pre>

<a id="l_51"></a><span class="hl line">   51 </span>  <span class="hl slc">// do training iterations</span>
<a id="l_52"></a><span class="hl line">   52 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;Training network on MNIST with &quot;</span> <span class="hl sym">&lt;&lt;</span> train_ds<span class="hl sym">.</span><span class="hl kwd">size</span><span class="hl sym">();</span>
<a id="l_53"></a><span class="hl line">   53 </span>  cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot; training samples and &quot;</span> <span class="hl sym">&lt;&lt;</span> test_ds<span class="hl sym">.</span><span class="hl kwd">size</span><span class="hl sym">() &lt;&lt;</span> <span class="hl str">&quot; test samples&quot;</span> <span class="hl sym">&lt;&lt;</span> endl<span class="hl sym">;</span>
<a id="l_54"></a><span class="hl line">   54 </span>  <span class="hl kwa">for</span> <span class="hl sym">(</span><span class="hl kwb">int</span> i <span class="hl sym">=</span> <span class="hl num">0</span><span class="hl sym">;</span> i <span class="hl sym">&lt;</span> <span class="hl num">5</span><span class="hl sym">; ++</span>i<span class="hl sym">) {</span>
<a id="l_55"></a><span class="hl line">   55 </span>    thetrainer<span class="hl sym">.</span><span class="hl kwd">train</span><span class="hl sym">(</span>train_ds<span class="hl sym">,</span> trainmeter<span class="hl sym">,</span> gdp<span class="hl sym">,</span> <span class="hl num">1</span><span class="hl sym">);</span>
<a id="l_56"></a><span class="hl line">   56 </span>    cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot;training: &quot;</span> <span class="hl sym">&lt;&lt;</span> flush<span class="hl sym">;</span>
<a id="l_57"></a><span class="hl line">   57 </span>    thetrainer<span class="hl sym">.</span><span class="hl kwd">test</span><span class="hl sym">(</span>train_ds<span class="hl sym">,</span> trainmeter<span class="hl sym">);</span>
<a id="l_58"></a><span class="hl line">   58 </span>    trainmeter<span class="hl sym">.</span><span class="hl kwd">display</span><span class="hl sym">();</span>
<a id="l_59"></a><span class="hl line">   59 </span>    cout <span class="hl sym">&lt;&lt;</span> <span class="hl str">&quot; testing: &quot;</span> <span class="hl sym">&lt;&lt;</span> flush<span class="hl sym">;</span>
<a id="l_60"></a><span class="hl line">   60 </span>    thetrainer<span class="hl sym">.</span><span class="hl kwd">test</span><span class="hl sym">(</span>test_ds<span class="hl sym">,</span> testmeter<span class="hl sym">);</span>
<a id="l_61"></a><span class="hl line">   61 </span>    testmeter<span class="hl sym">.</span><span class="hl kwd">display</span><span class="hl sym">();</span>
<a id="l_62"></a><span class="hl line">   62 </span>  <span class="hl sym">}</span>
<a id="l_63"></a><span class="hl line">   63 </span>  <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl sym">;</span>
<a id="l_64"></a><span class="hl line">   64 </span><span class="hl sym">}</span>
</pre></div>

</td></tr></table>
	</tr>
	</table>
  </body>
</html>
